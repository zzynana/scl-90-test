<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SCL-90ç—‡çŠ¶è‡ªè¯„é‡è¡¨</title>
    <!-- å¼•å…¥ html2canvas åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: #333;
            line-height: 1.5;
            min-height: 100vh;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        .container {
            max-width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.25);
        }
        h1 {
            font-size: 1.3rem;
            margin-bottom: 6px;
            font-weight: 600;
        }
        .subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 8px;
            margin: 15px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 6px;
            background: linear-gradient(to right, #ff9a44, #ff6b6b);
            border-radius: 8px;
            transition: width 0.4s ease;
        }
        .progress-text {
            text-align: center;
            font-size: 0.8rem;
            color: #666;
            margin-top: 6px;
        }
        #question-container {
            flex: 1;
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }
        .question-number {
            font-size: 0.8rem;
            color: #27ae60;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.4;
            flex: 1;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .option {
            padding: 14px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            text-align: center;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .option:hover {
            border-color: #bdc3c7;
        }
        .option.selected {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border-color: #27ae60;
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(39, 174, 96, 0.3);
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .nav-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        #prev-btn {
            background-color: #e9ecef;
            color: #666;
        }
        #prev-btn:active {
            background-color: #dee2e6;
        }
        #next-btn {
            background: linear-gradient(135deg, #ff9a44, #ff6b6b);
            color: white;
            box-shadow: 0 3px 8px rgba(255, 107, 107, 0.3);
        }
        #next-btn:disabled {
            background: #cccccc;
            color: #666666;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }
        #submit-btn {
            display: none;
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
            margin-top: 15px;
        }
        #submit-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 6px rgba(46, 204, 113, 0.3);
        }
        #result-container {
            display: none;
            flex: 1;
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
        }
        .result-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }
        .result-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .result-subtitle {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        /* æŠ¥å‘Šéƒ¨åˆ†æ ·å¼ */
        .section-title {
            font-size: 1.1rem;
            color: #2c3e50;
            margin: 25px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
            font-weight: 600;
        }
        .score-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        .score-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .score-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 8px 0;
            color: #2c3e50;
        }
        .score-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        /* ç´§å‡‘çš„åˆ—è¡¨æ ·å¼ */
        .compact-table {
            width: 100%;
            margin: 15px 0;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        .compact-table th {
            background: #f8f9fa;
            padding: 10px 8px;
            text-align: center;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e9ecef;
        }
        .compact-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #f1f3f4;
        }
        .compact-table tr:last-child td {
            border-bottom: none;
        }
        .level-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .level-normal { 
            background: #e8f6f3; 
            color: #27ae60; 
        }
        .level-mild { 
            background: #fff3e0; 
            color: #f39c12; 
        }
        .level-moderate { 
            background: #ffeaa7; 
            color: #e67e22; 
        }
        .level-severe { 
            background: #ffebee; 
            color: #e74c3c; 
        }
        
        /* å› å­è§£é‡Š */
        .factor-explanation {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            margin-bottom: 10px;
        }
        .explanation-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        /* ç»“æœè§£é‡Š */
        .interpretation-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #2ecc71;
            margin: 20px 0;
        }
        .interpretation-content h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        .interpretation-content p {
            margin-bottom: 12px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .interpretation-content p:last-child {
            margin-bottom: 0;
        }

        /* ä¿å­˜æŒ‰é’®æ ·å¼ */
        .save-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .save-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        #save-image-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 3px 8px rgba(52, 152, 219, 0.3);
        }
        #save-image-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 6px rgba(52, 152, 219, 0.3);
        }
        #new-test-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 3px 8px rgba(231, 76, 60, 0.3);
        }
        #new-test-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 6px rgba(231, 76, 60, 0.3);
        }
        
        .disclaimer {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #856404;
            text-align: center;
        }
        
        /* é”™è¯¯æç¤ºæ ·å¼ */
        .error-message {
            display: none;
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            border-left: 4px solid #e53935;
        }
        .reload-btn {
            background: #e53935;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            margin-top: 10px;
            cursor: pointer;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>SCL-90ç—‡çŠ¶è‡ªè¯„é‡è¡¨</h1>
            <div class="subtitle">è¯·æ ¹æ®æ‚¨æœ€è¿‘ä¸€å‘¨çš„å®é™…æ„Ÿè§‰è¿›è¡Œæµ‹è¯„</div>
        </header>

        <!-- é”™è¯¯æç¤ºåŒºåŸŸ -->
        <div class="error-message" id="error-message">
            <p>åº”ç”¨åŠ è½½å¤±è´¥ï¼Œè¯·å°è¯•åˆ·æ–°é¡µé¢</p>
            <button class="reload-btn" onclick="window.location.reload()">åˆ·æ–°é¡µé¢</button>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="progress-text" id="progress-text">è¿›åº¦: 0/90</div>

        <div id="question-container">
            <div class="question-number" id="question-number">é¢˜ç›® 1</div>
            <div class="question-text" id="question-text"></div>
            <div class="options" id="options-container"></div>
            <div class="nav-buttons">
                <button class="nav-btn" id="prev-btn">ä¸Šä¸€é¢˜</button>
                <button class="nav-btn" id="next-btn" disabled>ä¸‹ä¸€é¢˜</button>
            </div>
            <button id="submit-btn">æäº¤æµ‹è¯•ï¼ŒæŸ¥çœ‹æŠ¥å‘Š</button>
        </div>

        <div id="result-container">
            <div class="result-header">
                <div class="result-title">æ‚¨çš„ä¸“ä¸šæµ‹è¯„æŠ¥å‘Š</div>
                <div class="result-subtitle">åŸºäºSCL-90ç—‡çŠ¶è‡ªè¯„é‡è¡¨çš„è¯¦ç»†åˆ†æ</div>
            </div>

            <!-- ä¿å­˜å›¾ç‰‡æŒ‰é’® -->
            <div class="save-buttons">
                <button class="save-btn" id="save-image-btn">ğŸ’¾ ç”ŸæˆæŠ¥å‘Šå›¾ç‰‡</button>
                <button class="save-btn" id="new-test-btn">ğŸ”„ é‡æ–°æµ‹è¯•</button>
            </div>

            <!-- æ€»ä½“åˆ†æ•° -->
            <div class="score-cards">
                <div class="score-card">
                    <div class="score-label">æ€»åˆ†</div>
                    <div class="score-value" id="total-score">0</div>
                    <div class="score-label">ç†è®ºèŒƒå›´: 90-450åˆ†</div>
                </div>
                <div class="score-card">
                    <div class="score-label">æ€»å‡åˆ†</div>
                    <div class="score-value" id="average-score">0.00</div>
                    <div class="score-label">èŒƒå›´: 1-5åˆ†</div>
                </div>
            </div>

            <!-- å„å› å­åˆ†æ - ç´§å‡‘è¡¨æ ¼ -->
            <div class="section-title">å„å› å­å¾—åˆ†åŠæµ‹è¯•æƒ…å†µ</div>
            <div id="factor-analysis"></div>

            <!-- å› å­è§£é‡Šè¯´æ˜ -->
            <div class="section-title">å› å­è§£é‡Šè¯´æ˜</div>
            <div id="factor-explanations"></div>

            <!-- åˆ†çº§æ ‡å‡† - ç´§å‡‘è¡¨æ ¼ -->
            <div class="section-title">æµ‹è¯•æƒ…å†µåˆ†çº§æ ‡å‡†</div>
            <div id="criteria-container"></div>

            <!-- ç»“æœè§£é‡Š -->
            <div class="interpretation-content" id="overall-interpretation"></div>

            <!-- ä¸“ä¸šå‚è€ƒæ ‡å‡† -->
            <div class="interpretation-content">
                <h4>ä¸“ä¸šå‚è€ƒæ ‡å‡†</h4>
                <p>æŒ‰ä¸­å›½å¸¸æ¨¡ç»“æœï¼š</p>
                <p>â€¢ å¦‚æœSCL-90æ€»åˆ†è¶…è¿‡<strong>160åˆ†</strong>ï¼Œå•é¡¹å‡åˆ†è¶…è¿‡<strong>2åˆ†</strong>å°±åº”ä½œè¿›ä¸€æ­¥æ£€æŸ¥</p>
                <p>â€¢ æ ‡å‡†åˆ†ä¸ºå¤§äº<strong>200åˆ†</strong>è¯´æ˜ä½ æœ‰å¾ˆæ˜æ˜¾çš„å¿ƒç†é—®é¢˜ï¼Œå¯æ±‚åŠ©äºå¿ƒç†å’¨è¯¢</p>
                <p>â€¢ å¤§äº<strong>250åˆ†</strong>åˆ™æ¯”è¾ƒä¸¥é‡ï¼Œéœ€è¦ä½œåŒ»å­¦ä¸Šçš„è¯¦ç»†æ£€æŸ¥ï¼Œå¾ˆå¯èƒ½è¦åšé’ˆå¯¹æ€§çš„å¿ƒç†æ²»ç–—æˆ–åœ¨åŒ»ç”Ÿçš„æŒ‡å¯¼ä¸‹æœè¯</p>
            </div>

            <div class="disclaimer">
                <strong>å…è´£å£°æ˜ï¼š</strong>æœ¬æµ‹è¯•ç»“æœä»…ä¾›å‚è€ƒï¼Œä¸èƒ½ä½œä¸ºä¸“ä¸šè¯Šæ–­ä¾æ®ã€‚å¦‚æœ‰å›°æ‰°ï¼Œè¯·åŠæ—¶å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚
            </div>
        </div>
    </div>

    <script>
        // é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('JavaScripté”™è¯¯:', e.error);
            document.getElementById('error-message').style.display = 'block';
            document.getElementById('question-container').style.display = 'none';
            document.getElementById('progress-text').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
        });

        // SCL-90å®Œæ•´é¢˜ç›®
        const questions = [
            "å¤´ç—›", "ç¥ç»è¿‡æ•ï¼Œå¿ƒä¸­ä¸è¸å®", "å¤´è„‘ä¸­æœ‰ä¸å¿…è¦çš„æƒ³æ³•æˆ–å­—å¥ç›˜æ—‹", "å¤´æ˜æˆ–æ˜å€’", "å¯¹å¼‚æ€§çš„å…´è¶£å‡é€€",
            "å¯¹æ—äººè´£å¤‡æ±‚å…¨", "æ„Ÿåˆ°åˆ«äººèƒ½æ§åˆ¶æ‚¨çš„æ€æƒ³", "è´£æ€ªåˆ«äººåˆ¶é€ éº»çƒ¦", "å¿˜è®°æ€§å¤§", "æ‹…å¿ƒè‡ªå·±çš„è¡£é¥°æ•´é½åŠä»ªæ€çš„ç«¯æ­£",
            "å®¹æ˜“çƒ¦æ¼å’Œæ¿€åŠ¨", "èƒ¸ç—›", "å®³æ€•ç©ºæ—·çš„åœºæ‰€æˆ–è¡—é“", "æ„Ÿåˆ°è‡ªå·±çš„ç²¾åŠ›ä¸‹é™ï¼Œæ´»åŠ¨å‡æ…¢", "æƒ³ç»“æŸè‡ªå·±çš„ç”Ÿå‘½",
            "å¬åˆ°æ—äººå¬ä¸åˆ°çš„å£°éŸ³", "å‘æŠ–", "æ„Ÿåˆ°å¤§å¤šæ•°äººéƒ½ä¸å¯ä¿¡ä»»", "èƒƒå£ä¸å¥½", "å®¹æ˜“å“­æ³£",
            "åŒå¼‚æ€§ç›¸å¤„æ—¶æ„Ÿåˆ°å®³ç¾ä¸è‡ªåœ¨", "æ„Ÿåˆ°å—éª—ï¼Œä¸­äº†åœˆå¥—æˆ–æœ‰äººæƒ³æŠ“ä½æ‚¨", "æ— ç¼˜æ— æ•…åœ°çªç„¶æ„Ÿåˆ°å®³æ€•", "è‡ªå·±ä¸èƒ½æ§åˆ¶åœ°å¤§å‘è„¾æ°”", "æ€•å•ç‹¬å‡ºé—¨",
            "ç»å¸¸è´£æ€ªè‡ªå·±", "è…°ç—›", "æ„Ÿåˆ°éš¾ä»¥å®Œæˆä»»åŠ¡", "æ„Ÿåˆ°å­¤ç‹¬", "æ„Ÿåˆ°è‹¦é—·",
            "è¿‡åˆ†æ‹…å¿§", "å¯¹äº‹ç‰©ä¸æ„Ÿå…´è¶£", "æ„Ÿåˆ°å®³æ€•", "æ‚¨çš„æ„Ÿæƒ…å®¹æ˜“å—åˆ°ä¼¤å®³", "æ—äººèƒ½çŸ¥é“æ‚¨çš„ç§ä¸‹æƒ³æ³•",
            "æ„Ÿåˆ°åˆ«äººä¸ç†è§£æ‚¨ã€ä¸åŒæƒ…æ‚¨", "æ„Ÿåˆ°äººä»¬å¯¹æ‚¨ä¸å‹å¥½ï¼Œä¸å–œæ¬¢æ‚¨", "åšäº‹å¿…é¡»åšå¾—å¾ˆæ…¢ä»¥ä¿è¯åšå¾—æ­£ç¡®", "å¿ƒè·³å¾—å¾ˆå‰å®³", "æ¶å¿ƒæˆ–èƒƒéƒ¨ä¸èˆ’æœ",
            "æ„Ÿåˆ°æ¯”ä¸ä¸Šä»–äºº", "è‚Œè‚‰é…¸ç—›", "æ„Ÿåˆ°æœ‰äººåœ¨ç›‘è§†æ‚¨ã€è°ˆè®ºæ‚¨", "éš¾ä»¥å…¥ç¡", "åšäº‹å¿…é¡»åå¤æ£€æŸ¥",
            "éš¾ä»¥ä½œå‡ºå†³å®š", "æ€•ä¹˜ç”µè½¦ã€å…¬å…±æ±½è½¦ã€åœ°é“æˆ–ç«è½¦", "å‘¼å¸æœ‰å›°éš¾", "ä¸€é˜µé˜µå‘å†·æˆ–å‘çƒ­", "å› ä¸ºæ„Ÿåˆ°å®³æ€•è€Œé¿å¼€æŸäº›ä¸œè¥¿ã€åœºåˆæˆ–æ´»åŠ¨",
            "è„‘å­å˜ç©ºäº†", "èº«ä½“å‘éº»æˆ–åˆºç—›", "å–‰å’™æœ‰æ¢—å¡æ„Ÿ", "æ„Ÿåˆ°æ²¡æœ‰å‰é€”æ²¡æœ‰å¸Œæœ›", "ä¸èƒ½é›†ä¸­æ³¨æ„",
            "æ„Ÿåˆ°èº«ä½“çš„æŸä¸€éƒ¨åˆ†è½¯å¼±æ— åŠ›", "æ„Ÿåˆ°ç´§å¼ æˆ–å®¹æ˜“ç´§å¼ ", "æ„Ÿåˆ°æ‰‹æˆ–è„šå‘é‡", "æƒ³åˆ°æ­»äº¡çš„äº‹", "åƒå¾—å¤ªå¤š",
            "å½“åˆ«äººçœ‹ç€æ‚¨æˆ–è°ˆè®ºæ‚¨æ—¶æ„Ÿåˆ°ä¸è‡ªåœ¨", "æœ‰ä¸€äº›ä¸å±äºæ‚¨è‡ªå·±çš„æƒ³æ³•", "æœ‰æƒ³æ‰“äººæˆ–ä¼¤å®³ä»–äººçš„å†²åŠ¨", "é†’å¾—å¤ªæ—©", "å¿…é¡»åå¤æ´—æ‰‹ã€ç‚¹æ•°ç›®æˆ–è§¦æ‘¸æŸäº›ä¸œè¥¿",
            "ç¡å¾—ä¸ç¨³ä¸æ·±", "æœ‰æƒ³æ‘”åæˆ–ç ´åä¸œè¥¿çš„å†²åŠ¨", "æœ‰ä¸€äº›åˆ«äººæ²¡æœ‰çš„æƒ³æ³•æˆ–å¿µå¤´", "æ„Ÿåˆ°å¯¹åˆ«äººç¥ç»è¿‡æ•", "åœ¨å•†åº—æˆ–ç”µå½±é™¢ç­‰äººå¤šçš„åœ°æ–¹æ„Ÿåˆ°ä¸è‡ªåœ¨",
            "æ„Ÿåˆ°ä»»ä½•äº‹æƒ…éƒ½å¾ˆå›°éš¾", "ä¸€é˜µé˜µææƒ§æˆ–æƒŠæ", "æ„Ÿåˆ°åœ¨å…¬å…±åœºåˆåƒä¸œè¥¿å¾ˆä¸èˆ’æœ", "ç»å¸¸ä¸äººäº‰è®º", "å•ç‹¬ä¸€äººæ—¶ç¥ç»å¾ˆç´§å¼ ",
            "åˆ«äººå¯¹æ‚¨çš„æˆç»©æ²¡æœ‰ä½œå‡ºæ°å½“çš„è¯„ä»·", "å³ä½¿å’Œåˆ«äººåœ¨ä¸€èµ·ä¹Ÿæ„Ÿåˆ°å­¤å•", "æ„Ÿåˆ°åç«‹ä¸å®‰å¿ƒç¥ä¸å®š", "æ„Ÿåˆ°è‡ªå·±æ²¡æœ‰ä»€ä¹ˆä»·å€¼", "æ„Ÿåˆ°ç†Ÿæ‚‰çš„ä¸œè¥¿å˜æˆé™Œç”Ÿæˆ–ä¸è±¡æ˜¯çœŸçš„",
            "å¤§å«æˆ–æ‘”ä¸œè¥¿", "å®³æ€•ä¼šåœ¨å…¬å…±åœºåˆæ˜å€’", "æ„Ÿåˆ°åˆ«äººæƒ³å æ‚¨çš„ä¾¿å®œ", "ä¸ºä¸€äº›æœ‰å…³\"æ€§\"çš„æƒ³æ³•è€Œå¾ˆè‹¦æ¼", "æ‚¨è®¤ä¸ºåº”è¯¥å› ä¸ºè‡ªå·±çš„è¿‡é”™è€Œå—åˆ°æƒ©ç½š",
            "æ„Ÿåˆ°è¦èµ¶å¿«æŠŠäº‹æƒ…åšå®Œ", "æ„Ÿåˆ°è‡ªå·±çš„èº«ä½“æœ‰ä¸¥é‡é—®é¢˜", "ä»æœªæ„Ÿåˆ°å’Œå…¶ä»–äººå¾ˆäº²è¿‘", "æ„Ÿåˆ°è‡ªå·±æœ‰ç½ª", "æ„Ÿåˆ°è‡ªå·±çš„è„‘å­æœ‰æ¯›ç—…"
        ];

        // å› å­åˆ†ç»„
        const factors = {
            "èº¯ä½“åŒ–": [0, 3, 11, 26, 39, 41, 47, 51, 52, 55, 57],
            "å¼ºè¿«ç—‡çŠ¶": [2, 8, 9, 27, 37, 44, 45, 50, 54, 64],
            "äººé™…å…³ç³»æ•æ„Ÿ": [5, 20, 33, 35, 36, 40, 60, 68, 72],
            "æŠ‘éƒ": [4, 13, 14, 19, 21, 25, 28, 29, 30, 53, 70, 78],
            "ç„¦è™‘": [1, 16, 22, 32, 38, 56, 66, 77, 79, 85],
            "æ•Œå¯¹": [10, 23, 62, 66, 73, 80],
            "ææ€–": [12, 24, 46, 49, 69, 74, 81],
            "åæ‰§": [7, 17, 42, 67, 75, 82],
            "ç²¾ç¥ç—…æ€§": [6, 15, 34, 61, 63, 71, 76, 83, 84, 89],
            "å…¶ä»–ï¼ˆç¡çœ é¥®é£Ÿï¼‰": [18, 43, 58, 59, 64, 65]
        };

        // å› å­è§£é‡Šè¯´æ˜åº“
        const factorExplanations = {
            "èº¯ä½“åŒ–": "ä¸»è¦åæ˜ ä¸»è§‚çš„èº«ä½“ä¸é€‚æ„Ÿï¼ŒåŒ…æ‹¬å¿ƒè¡€ç®¡ã€èƒƒè‚ é“ã€å‘¼å¸ç³»ç»Ÿçš„ä¸é€‚ï¼Œä»¥åŠå¤´ç—›ã€èƒŒç—›ã€è‚Œè‚‰é…¸ç—›ç­‰èº¯ä½“ç—‡çŠ¶ã€‚",
            "å¼ºè¿«ç—‡çŠ¶": "æŒ‡é‚£äº›æ˜çŸ¥æ²¡æœ‰å¿…è¦ï¼Œä½†åˆæ— æ³•æ‘†è„±çš„æ— æ„ä¹‰æ€æƒ³ã€å†²åŠ¨å’Œè¡Œä¸ºï¼Œå¦‚åå¤æ£€æŸ¥ã€æ´—æ¶¤ã€è®¡æ•°ç­‰ã€‚",
            "äººé™…å…³ç³»æ•æ„Ÿ": "æŒ‡äººé™…äº¤å¾€ä¸­çš„ä¸è‡ªåœ¨æ„Ÿå’Œè‡ªå‘æ„Ÿï¼Œå°¤å…¶æ˜¯åœ¨ä¸ä»–äººæ¯”è¾ƒæ—¶æ›´åŠ çªå‡ºï¼Œè¡¨ç°ä¸ºç¤¾äº¤ç„¦è™‘å’Œè‡ªå‘ã€‚",
            "æŠ‘éƒ": "åæ˜ ä¸ä¸´åºŠæŠ‘éƒç—‡çŠ¶ç›¸å…³çš„å¹¿æ³›ç—‡çŠ¶ï¼ŒåŒ…æ‹¬å¿ƒå¢ƒä½è½ã€å…´è¶£å‡é€€ã€ç¼ºä¹åŠ¨åŠ›ã€å¤±æœ›ã€æ‚²è§‚ç­‰æƒ…æ„Ÿä½“éªŒã€‚",
            "ç„¦è™‘": "åŒ…æ‹¬çƒ¦èºã€åç«‹ä¸å®‰ã€ç¥ç»è¿‡æ•ã€ç´§å¼ ä»¥åŠèº¯ä½“çš„éœ‡é¢¤ã€å¿ƒæ‚¸ã€å¤´æ™•ç­‰ç„¦è™‘ç—‡çŠ¶ã€‚",
            "æ•Œå¯¹": "ä¸»è¦ä»æ€æƒ³ã€æƒ…æ„Ÿå’Œè¡Œä¸ºä¸‰ä¸ªæ–¹é¢åæ˜ æ•Œå¯¹çš„è¡¨ç°ï¼ŒåŒ…æ‹¬åŒçƒ¦ã€äº‰è®ºã€æ‘”ç‰©ã€å†²åŠ¨ç­‰ã€‚",
            "ææ€–": "åæ˜ å¯¹ç¤¾äº¤åœºåˆå’Œç‰¹å®šç‰©ä½“çš„ææƒ§ï¼Œå¦‚å‡ºé—¨æ—…è¡Œã€ç©ºæ—·åœºåœ°ã€äººç¾¤æˆ–å…¬å…±äº¤é€šå·¥å…·ç­‰ã€‚",
            "åæ‰§": "æŒ‡çŒœç–‘å’Œå…³ç³»å¦„æƒ³ç­‰åæ‰§æ€§æ€ç»´ï¼ŒåŒ…æ‹¬æ•Œå¯¹ã€çŒœç–‘ã€å¤¸å¤§ã€è¢«å®³ç­‰è§‚å¿µã€‚",
            "ç²¾ç¥ç—…æ€§": "åæ˜ å„ç§ç²¾ç¥ç—…æ€§ç—‡çŠ¶çš„è½»åº¦è¡¨ç°ï¼Œå¦‚å¹»å¬ã€æ€ç»´æ’­æ•£ã€è¢«æ§åˆ¶æ„Ÿç­‰ã€‚",
            "å…¶ä»–ï¼ˆç¡çœ é¥®é£Ÿï¼‰": "ä¸»è¦åæ˜ ç¡çœ å’Œé¥®é£Ÿæ–¹é¢çš„é—®é¢˜ï¼Œå¦‚å¤±çœ ã€æ—©é†’ã€å¤šæ¢¦ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ã€‚"
        };

        const options = ["æ²¡æœ‰", "å¾ˆè½»", "ä¸­ç­‰", "åé‡", "ä¸¥é‡"];
        let currentQuestion = 0;
        let answers = new Array(questions.length).fill(null);
        let factorLevels = {}; // å­˜å‚¨æ¯ä¸ªå› å­çš„ç¨‹åº¦

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            try {
                showQuestion(currentQuestion);
                updateProgress();
                
                document.getElementById('prev-btn').addEventListener('click', prevQuestion);
                document.getElementById('next-btn').addEventListener('click', nextQuestion);
                document.getElementById('submit-btn').addEventListener('click', showResults);
                
                // æ£€æŸ¥html2canvasæ˜¯å¦åŠ è½½æˆåŠŸ
                if (typeof html2canvas === 'undefined') {
                    console.warn('html2canvasæœªæ­£ç¡®åŠ è½½ï¼Œå›¾ç‰‡ä¿å­˜åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨');
                }
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('question-container').style.display = 'none';
            }
        }

        // æ˜¾ç¤ºé¢˜ç›®
        function showQuestion(index) {
            document.getElementById('question-number').textContent = `é¢˜ç›® ${index + 1}`;
            document.getElementById('question-text').textContent = questions[index];
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            options.forEach((option, i) => {
                const optionElement = document.createElement('div');
                optionElement.className = `option ${answers[index] === i ? 'selected' : ''}`;
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => selectOption(i));
                optionsContainer.appendChild(optionElement);
            });
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('prev-btn').style.display = index === 0 ? 'none' : 'block';
            document.getElementById('next-btn').style.display = index === questions.length - 1 ? 'none' : 'block';
            document.getElementById('submit-btn').style.display = index === questions.length - 1 ? 'block' : 'none';
            
            // æ›´æ–°ä¸‹ä¸€é¢˜æŒ‰é’®çŠ¶æ€
            updateNextButton();
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(optionIndex) {
            answers[currentQuestion] = optionIndex;
            showQuestion(currentQuestion);
            
            // è‡ªåŠ¨è·³è½¬åˆ°ä¸‹ä¸€é¢˜ï¼ˆå¦‚æœä¸æ˜¯æœ€åä¸€é¢˜ï¼‰
            if (currentQuestion < questions.length - 1) {
                setTimeout(() => {
                    currentQuestion++;
                    showQuestion(currentQuestion);
                    updateProgress();
                }, 300);
            } else {
                updateNextButton();
            }
        }

        // æ›´æ–°ä¸‹ä¸€é¢˜æŒ‰é’®çŠ¶æ€
        function updateNextButton() {
            const nextButton = document.getElementById('next-btn');
            if (answers[currentQuestion] === null) {
                nextButton.disabled = true;
            } else {
                nextButton.disabled = false;
            }
        }

        // ä¸Šä¸€é¢˜
        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
                updateProgress();
            }
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            if (currentQuestion < questions.length - 1 && answers[currentQuestion] !== null) {
                currentQuestion++;
                showQuestion(currentQuestion);
                updateProgress();
            }
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `è¿›åº¦: ${currentQuestion + 1}/${questions.length}`;
        }

        // è®¾ç½®ä¿å­˜åŠŸèƒ½
        function setupSaveFunction() {
            const saveButton = document.getElementById('save-image-btn');
            const newTestButton = document.getElementById('new-test-btn');
            
            // ä¿å­˜å›¾ç‰‡åŠŸèƒ½
            saveButton.addEventListener('click', function() {
                if (typeof html2canvas === 'undefined') {
                    alert('å›¾ç‰‡ç”ŸæˆåŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•');
                    return;
                }
                
                saveButton.disabled = true;
                saveButton.textContent = 'æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...';
                
                // ä¸´æ—¶éšè—ä¿å­˜æŒ‰é’®ï¼Œé¿å…å‡ºç°åœ¨æˆªå›¾ä¸­
                const saveButtons = document.querySelector('.save-buttons');
                const originalDisplay = saveButtons.style.display;
                saveButtons.style.display = 'none';
                
                // ä½¿ç”¨html2canvasç”Ÿæˆå›¾ç‰‡
                html2canvas(document.getElementById('result-container'), {
                    scale: 2, // æé«˜å›¾ç‰‡è´¨é‡
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    // å°†canvasè½¬æ¢ä¸ºå›¾ç‰‡URL
                    const imageURL = canvas.toDataURL('image/png');
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const downloadLink = document.createElement('a');
                    downloadLink.href = imageURL;
                    downloadLink.download = 'SCL-90æµ‹è¯„æŠ¥å‘Š.png';
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    saveButtons.style.display = originalDisplay;
                    saveButton.disabled = false;
                    saveButton.textContent = 'ğŸ’¾ ç”ŸæˆæŠ¥å‘Šå›¾ç‰‡';
                    
                }).catch(error => {
                    console.error('ç”Ÿæˆå›¾ç‰‡å¤±è´¥:', error);
                    alert('ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    saveButtons.style.display = originalDisplay;
                    saveButton.disabled = false;
                    saveButton.textContent = 'ğŸ’¾ ç”ŸæˆæŠ¥å‘Šå›¾ç‰‡';
                });
            });
            
            // é‡æ–°æµ‹è¯•åŠŸèƒ½
            newTestButton.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æµ‹è¯•å—ï¼Ÿå½“å‰ç»“æœå°†ä¼šä¸¢å¤±ã€‚')) {
                    // é‡ç½®æ‰€æœ‰çŠ¶æ€
                    currentQuestion = 0;
                    answers = new Array(questions.length).fill(null);
                    factorLevels = {};
                    
                    // æ˜¾ç¤ºæµ‹è¯•é¡µé¢ï¼Œéšè—ç»“æœé¡µé¢
                    document.getElementById('question-container').style.display = 'block';
                    document.getElementById('result-container').style.display = 'none';
                    document.getElementById('progress-text').style.display = 'block';
                    document.querySelector('.progress-container').style.display = 'block';
                    
                    // é‡æ–°åˆå§‹åŒ–ç¬¬ä¸€é¢˜
                    showQuestion(currentQuestion);
                    updateProgress();
                }
            });
        }

        // æ˜¾ç¤ºç»“æœ
        function showResults() {
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰é¢˜ç›®éƒ½å·²å›ç­”
            if (answers.includes(null)) {
                alert('è¯·å®Œæˆæ‰€æœ‰é¢˜ç›®åå†æäº¤');
                return;
            }

            // è®¡ç®—æ€»åˆ†å’Œå‡åˆ†
            const totalScore = answers.reduce((sum, answer) => sum + (answer + 1), 0);
            const averageScore = (totalScore / questions.length).toFixed(2);

            // æ˜¾ç¤ºæ€»åˆ†å’Œå‡åˆ†
            document.getElementById('total-score').textContent = totalScore;
            document.getElementById('average-score').textContent = averageScore;

            // ç”Ÿæˆå› å­åˆ†æéƒ¨åˆ† - ç´§å‡‘è¡¨æ ¼
            const factorAnalysisContainer = document.getElementById('factor-analysis');
            factorAnalysisContainer.innerHTML = '';

            const factorTable = document.createElement('table');
            factorTable.className = 'compact-table';
            factorTable.innerHTML = `
                <thead>
                    <tr>
                        <th>å› å­åç§°</th>
                        <th>æ€»åˆ†</th>
                        <th>å¹³å‡åˆ†</th>
                        <th>æµ‹è¯•æƒ…å†µ</th>
                    </tr>
                </thead>
                <tbody id="factor-table-body">
                </tbody>
            `;

            const factorTableBody = factorTable.querySelector('#factor-table-body');

            for (const [factorName, questionIndices] of Object.entries(factors)) {
                // è®¡ç®—å› å­åˆ†æ•°
                let factorTotal = 0;
                questionIndices.forEach(index => {
                    factorTotal += answers[index] + 1;
                });
                const factorAverage = (factorTotal / questionIndices.length).toFixed(2);
                
                // åˆ¤æ–­ç¨‹åº¦
                let levelClass = "", levelText = "";
                if (factorAverage < 1.5) {
                    levelClass = "level-normal"; levelText = "æ­£å¸¸";
                } else if (factorAverage < 2.0) {
                    levelClass = "level-mild"; levelText = "è½»å¾®";
                } else if (factorAverage < 3.0) {
                    levelClass = "level-moderate"; levelText = "ä¸­åº¦";
                } else {
                    levelClass = "level-severe"; levelText = "é‡åº¦";
                }

                // å­˜å‚¨å› å­ç¨‹åº¦
                factorLevels[factorName] = { levelClass, levelText };

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${factorName}</td>
                    <td>${factorTotal}</td>
                    <td>${factorAverage}</td>
                    <td><span class="level-badge ${levelClass}">${levelText}</span></td>
                `;
                factorTableBody.appendChild(row);
            }

            factorAnalysisContainer.appendChild(factorTable);

            // ç”Ÿæˆåˆ†çº§æ ‡å‡† - ç´§å‡‘è¡¨æ ¼
            const criteriaContainer = document.getElementById('criteria-container');
            criteriaContainer.innerHTML = '';

            const criteriaTable = document.createElement('table');
            criteriaTable.className = 'compact-table';
            criteriaTable.innerHTML = `
                <thead>
                    <tr>
                        <th>ç¨‹åº¦</th>
                        <th>å¹³å‡åˆ†èŒƒå›´</th>
                        <th>è¯´æ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="level-badge level-normal">æ­£å¸¸</span></td>
                        <td>1.0-1.5</td>
                        <td>æ— æ˜æ˜¾ç—‡çŠ¶</td>
                    </tr>
                    <tr>
                        <td><span class="level-badge level-mild">è½»å¾®</span></td>
                        <td>1.5-2.0</td>
                        <td>ç—‡çŠ¶è½»å¾®æˆ–å¶å°”å‡ºç°</td>
                    </tr>
                    <tr>
                        <td><span class="level-badge level-moderate">ä¸­åº¦</span></td>
                        <td>2.0-3.0</td>
                        <td>ç—‡çŠ¶æ˜æ˜¾ä½†ä¸å½±å“æ—¥å¸¸ç”Ÿæ´»</td>
                    </tr>
                    <tr>
                        <td><span class="level-badge level-severe">é‡åº¦</span></td>
                        <td>3.0-5.0</td>
                        <td>ç—‡çŠ¶ä¸¥é‡ä¸”æ˜æ˜¾å½±å“æ—¥å¸¸ç”Ÿæ´»</td>
                    </tr>
                </tbody>
            `;
            criteriaContainer.appendChild(criteriaTable);

            // å› å­è§£é‡Š - åŒ…å«ä¸ªäººæµ‹è¯•ç»“æœ
            const factorExplanationsContainer = document.getElementById('factor-explanations');
            factorExplanationsContainer.innerHTML = '';

            for (const [factorName, explanation] of Object.entries(factorExplanations)) {
                const userLevel = factorLevels[factorName];
                const explanationElement = document.createElement('div');
                explanationElement.className = 'factor-explanation';
                explanationElement.innerHTML = `
                    <div class="explanation-title">${factorName}ï¼š<span class="level-badge ${userLevel.levelClass}">${userLevel.levelText}</span></div>
                    <div>${explanation}</div>
                `;
                factorExplanationsContainer.appendChild(explanationElement);
            }

            // æ¸©é¦¨è§£è¯»
            const warmInterpretation = `
                <h4>è‡´äº²çˆ±çš„ä½ ï¼š</h4>
                <p>è¯·ç”¨ä»å®¹çš„å¿ƒæ€æ¥çœ‹å¾…æœ¬æ¬¡æµ‹è¯•ã€‚æ— è®ºåˆ†æ•°å¦‚ä½•ï¼Œè¯·ä¸€å®šè®°å¾—ï¼Œæˆ‘ä»¬å§‹ç»ˆéƒ½åœ¨ä½ èº«è¾¹ã€‚</p>
                
                <p>SCL-90 å¿ƒç†å¥åº·è‡ªè¯„é‡è¡¨æ¶µç›–äº†æƒ…ç»ªçŠ¶æ€ã€æ€ç»´æ¨¡å¼ã€äººé™…å…³ç³»ã€ç”Ÿæ´»ä¹ æƒ¯ç­‰å¤šä¸ªç»´åº¦ï¼Œå®ƒå°±åƒä¸€é¢æ¸©æŸ”çš„é•œå­ï¼Œèƒ½å¸®ä½ æ›´æ¸…æ™°åœ°çœ‹è§è‡ªå·±å½“ä¸‹çš„å¿ƒç†çŠ¶æ€ã€‚éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œé‡è¡¨å¾—åˆ†ä»…ä»…æ˜¯è¿‘æœŸå¿ƒç†æ„Ÿå—çš„æŠ•å°„ã€‚</p>
                
                <p>è‹¥æŸäº›å› å­å¾—åˆ†è¾ƒé«˜ï¼Œæˆ–è®¸åªæ˜¯è¯´æ˜ä½ æœ€è¿‘åœ¨è¿™äº›æ–¹é¢æš‚æ—¶æ„Ÿå—åˆ°äº†å‹åŠ›æˆ–å›°æ‰°ï¼Œä½†è¿™ç»ä¸ç­‰äºä½ å­˜åœ¨ä¸¥é‡çš„é—®é¢˜ã€‚å¾ˆå¤šæ—¶å€™ï¼ŒçŸ­æœŸçš„å¿ƒç†æ³¢åŠ¨æœ¬å°±æ˜¯ç”Ÿæ´»çš„å¸¸æ€â€”â€”å¯èƒ½æ˜¯å­¦ä¹ çš„èŠ‚å¥ã€å·¥ä½œçš„æŒ‘æˆ˜ï¼Œæˆ–æ˜¯äººé™…äº¤å¾€ä¸­çš„å°æ’æ›²å¸¦æ¥çš„æš‚æ—¶å½±å“ã€‚</p>
                
                <p>å¦‚æœä½ å‘ç°è‡ªå·±åœ¨å¤šä¸ªç»´åº¦ä¸Šé•¿æœŸæ„Ÿåˆ°ä¸é€‚ï¼Œä¸å¦¨å¤šç»™è‡ªå·±ä¸€äº›å…³æ³¨ï¼šè¯•ç€è°ƒæ•´è‡ªå·±çš„ä½œæ¯è§„å¾‹ï¼Œæ‰¾åˆ°é€‚åˆè‡ªå·±çš„æ”¾æ¾æ–¹å¼ï¼Œæˆ–æ˜¯å’Œä¿¡ä»»çš„äººå¥½å¥½å€¾è¯‰èŠèŠã€‚å€˜è‹¥æƒ…ç»ªå·²ç»æ‚„æ‚„å½±å“åˆ°äº†æ—¥å¸¸ç”Ÿæ´»ï¼Œä¸”é è‡ªå·±éš¾ä»¥è°ƒèŠ‚ï¼Œä¹Ÿè¯·ä¸è¦çŠ¹è±«ï¼ŒåŠæ—¶å¯»æ±‚ä¸“ä¸šçš„å¿ƒç†å’¨è¯¢æˆ–å¸®åŠ©ï¼Œè¿™å¹¶ä¸æ˜¯è½¯å¼±ï¼Œè€Œæ˜¯å¯¹è‡ªå·±çš„è´Ÿè´£ã€‚è¦çŸ¥é“ï¼Œå¿ƒç†å¥åº·å’Œèº«ä½“å¥åº·åŒæ ·é‡è¦ï¼Œè€Œä½ ï¼Œæœ¬å°±å€¼å¾—è¢«å¥½å¥½å…³å¿ƒä¸åšå®šæ”¯æŒã€‚</p>
            `;

            document.getElementById('overall-interpretation').innerHTML = warmInterpretation;

            // æ˜¾ç¤ºæŠ¥å‘Šé¡µé¢
            document.getElementById('question-container').style.display = 'none';
            document.getElementById('result-container').style.display = 'block';
            document.getElementById('progress-text').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';

            // è®¾ç½®ä¿å­˜åŠŸèƒ½
            setTimeout(setupSaveFunction, 100);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
