<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SCL-90症状自评量表</title>
    <!-- 引入 html2canvas 库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: #333;
            line-height: 1.5;
            min-height: 100vh;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        .container {
            max-width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.25);
        }
        h1 {
            font-size: 1.3rem;
            margin-bottom: 6px;
            font-weight: 600;
        }
        .subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 8px;
            margin: 15px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 6px;
            background: linear-gradient(to right, #ff9a44, #ff6b6b);
            border-radius: 8px;
            transition: width 0.4s ease;
        }
        .progress-text {
            text-align: center;
            font-size: 0.8rem;
            color: #666;
            margin-top: 6px;
        }
        #question-container {
            flex: 1;
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }
        .question-number {
            font-size: 0.8rem;
            color: #27ae60;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.4;
            flex: 1;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .option {
            padding: 14px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            text-align: center;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .option:hover {
            border-color: #bdc3c7;
        }
        .option.selected {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border-color: #27ae60;
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(39, 174, 96, 0.3);
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .nav-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        #prev-btn {
            background-color: #e9ecef;
            color: #666;
        }
        #prev-btn:active {
            background-color: #dee2e6;
        }
        #next-btn {
            background: linear-gradient(135deg, #ff9a44, #ff6b6b);
            color: white;
            box-shadow: 0 3px 8px rgba(255, 107, 107, 0.3);
        }
        #next-btn:disabled {
            background: #cccccc;
            color: #666666;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }
        #submit-btn {
            display: none;
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
            margin-top: 15px;
        }
        #submit-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 6px rgba(46, 204, 113, 0.3);
        }
        #result-container {
            display: none;
            flex: 1;
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
        }
        .result-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }
        .result-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .result-subtitle {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        /* 报告部分样式 */
        .section-title {
            font-size: 1.1rem;
            color: #2c3e50;
            margin: 25px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
            font-weight: 600;
        }
        .score-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        .score-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .score-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 8px 0;
            color: #2c3e50;
        }
        .score-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        /* 紧凑的列表样式 */
        .compact-table {
            width: 100%;
            margin: 15px 0;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        .compact-table th {
            background: #f8f9fa;
            padding: 10px 8px;
            text-align: center;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e9ecef;
        }
        .compact-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #f1f3f4;
        }
        .compact-table tr:last-child td {
            border-bottom: none;
        }
        .level-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .level-normal { 
            background: #e8f6f3; 
            color: #27ae60; 
        }
        .level-mild { 
            background: #fff3e0; 
            color: #f39c12; 
        }
        .level-moderate { 
            background: #ffeaa7; 
            color: #e67e22; 
        }
        .level-severe { 
            background: #ffebee; 
            color: #e74c3c; 
        }
        
        /* 因子解释 */
        .factor-explanation {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            margin-bottom: 10px;
        }
        .explanation-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        /* 结果解释 */
        .interpretation-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #2ecc71;
            margin: 20px 0;
        }
        .interpretation-content h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        .interpretation-content p {
            margin-bottom: 12px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .interpretation-content p:last-child {
            margin-bottom: 0;
        }

        /* 保存按钮样式 */
        .save-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .save-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        #save-image-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 3px 8px rgba(52, 152, 219, 0.3);
        }
        #save-image-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 6px rgba(52, 152, 219, 0.3);
        }
        #new-test-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 3px 8px rgba(231, 76, 60, 0.3);
        }
        #new-test-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 6px rgba(231, 76, 60, 0.3);
        }
        
        .disclaimer {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #856404;
            text-align: center;
        }
        
        /* 错误提示样式 */
        .error-message {
            display: none;
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            border-left: 4px solid #e53935;
        }
        .reload-btn {
            background: #e53935;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            margin-top: 10px;
            cursor: pointer;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>SCL-90症状自评量表</h1>
            <div class="subtitle">请根据您最近一周的实际感觉进行测评</div>
        </header>

        <!-- 错误提示区域 -->
        <div class="error-message" id="error-message">
            <p>应用加载失败，请尝试刷新页面</p>
            <button class="reload-btn" onclick="window.location.reload()">刷新页面</button>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="progress-text" id="progress-text">进度: 0/90</div>

        <div id="question-container">
            <div class="question-number" id="question-number">题目 1</div>
            <div class="question-text" id="question-text"></div>
            <div class="options" id="options-container"></div>
            <div class="nav-buttons">
                <button class="nav-btn" id="prev-btn">上一题</button>
                <button class="nav-btn" id="next-btn" disabled>下一题</button>
            </div>
            <button id="submit-btn">提交测试，查看报告</button>
        </div>

        <div id="result-container">
            <div class="result-header">
                <div class="result-title">您的专业测评报告</div>
                <div class="result-subtitle">基于SCL-90症状自评量表的详细分析</div>
            </div>

            <!-- 保存图片按钮 -->
            <div class="save-buttons">
                <button class="save-btn" id="save-image-btn">💾 生成报告图片</button>
                <button class="save-btn" id="new-test-btn">🔄 重新测试</button>
            </div>

            <!-- 总体分数 -->
            <div class="score-cards">
                <div class="score-card">
                    <div class="score-label">总分</div>
                    <div class="score-value" id="total-score">0</div>
                    <div class="score-label">理论范围: 90-450分</div>
                </div>
                <div class="score-card">
                    <div class="score-label">总均分</div>
                    <div class="score-value" id="average-score">0.00</div>
                    <div class="score-label">范围: 1-5分</div>
                </div>
            </div>

            <!-- 各因子分析 - 紧凑表格 -->
            <div class="section-title">各因子得分及测试情况</div>
            <div id="factor-analysis"></div>

            <!-- 因子解释说明 -->
            <div class="section-title">因子解释说明</div>
            <div id="factor-explanations"></div>

            <!-- 分级标准 - 紧凑表格 -->
            <div class="section-title">测试情况分级标准</div>
            <div id="criteria-container"></div>

            <!-- 结果解释 -->
            <div class="interpretation-content" id="overall-interpretation"></div>

            <!-- 专业参考标准 -->
            <div class="interpretation-content">
                <h4>专业参考标准</h4>
                <p>按中国常模结果：</p>
                <p>• 如果SCL-90总分超过<strong>160分</strong>，单项均分超过<strong>2分</strong>就应作进一步检查</p>
                <p>• 标准分为大于<strong>200分</strong>说明你有很明显的心理问题，可求助于心理咨询</p>
                <p>• 大于<strong>250分</strong>则比较严重，需要作医学上的详细检查，很可能要做针对性的心理治疗或在医生的指导下服药</p>
            </div>

            <div class="disclaimer">
                <strong>免责声明：</strong>本测试结果仅供参考，不能作为专业诊断依据。如有困扰，请及时寻求专业帮助。
            </div>
        </div>
    </div>

    <script>
        // 错误处理
        window.addEventListener('error', function(e) {
            console.error('JavaScript错误:', e.error);
            document.getElementById('error-message').style.display = 'block';
            document.getElementById('question-container').style.display = 'none';
            document.getElementById('progress-text').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
        });

        // SCL-90完整题目
        const questions = [
            "头痛", "神经过敏，心中不踏实", "头脑中有不必要的想法或字句盘旋", "头昏或昏倒", "对异性的兴趣减退",
            "对旁人责备求全", "感到别人能控制您的思想", "责怪别人制造麻烦", "忘记性大", "担心自己的衣饰整齐及仪态的端正",
            "容易烦恼和激动", "胸痛", "害怕空旷的场所或街道", "感到自己的精力下降，活动减慢", "想结束自己的生命",
            "听到旁人听不到的声音", "发抖", "感到大多数人都不可信任", "胃口不好", "容易哭泣",
            "同异性相处时感到害羞不自在", "感到受骗，中了圈套或有人想抓住您", "无缘无故地突然感到害怕", "自己不能控制地大发脾气", "怕单独出门",
            "经常责怪自己", "腰痛", "感到难以完成任务", "感到孤独", "感到苦闷",
            "过分担忧", "对事物不感兴趣", "感到害怕", "您的感情容易受到伤害", "旁人能知道您的私下想法",
            "感到别人不理解您、不同情您", "感到人们对您不友好，不喜欢您", "做事必须做得很慢以保证做得正确", "心跳得很厉害", "恶心或胃部不舒服",
            "感到比不上他人", "肌肉酸痛", "感到有人在监视您、谈论您", "难以入睡", "做事必须反复检查",
            "难以作出决定", "怕乘电车、公共汽车、地铁或火车", "呼吸有困难", "一阵阵发冷或发热", "因为感到害怕而避开某些东西、场合或活动",
            "脑子变空了", "身体发麻或刺痛", "喉咙有梗塞感", "感到没有前途没有希望", "不能集中注意",
            "感到身体的某一部分软弱无力", "感到紧张或容易紧张", "感到手或脚发重", "想到死亡的事", "吃得太多",
            "当别人看着您或谈论您时感到不自在", "有一些不属于您自己的想法", "有想打人或伤害他人的冲动", "醒得太早", "必须反复洗手、点数目或触摸某些东西",
            "睡得不稳不深", "有想摔坏或破坏东西的冲动", "有一些别人没有的想法或念头", "感到对别人神经过敏", "在商店或电影院等人多的地方感到不自在",
            "感到任何事情都很困难", "一阵阵恐惧或惊恐", "感到在公共场合吃东西很不舒服", "经常与人争论", "单独一人时神经很紧张",
            "别人对您的成绩没有作出恰当的评价", "即使和别人在一起也感到孤单", "感到坐立不安心神不定", "感到自己没有什么价值", "感到熟悉的东西变成陌生或不象是真的",
            "大叫或摔东西", "害怕会在公共场合昏倒", "感到别人想占您的便宜", "为一些有关\"性\"的想法而很苦恼", "您认为应该因为自己的过错而受到惩罚",
            "感到要赶快把事情做完", "感到自己的身体有严重问题", "从未感到和其他人很亲近", "感到自己有罪", "感到自己的脑子有毛病"
        ];

        // 因子分组
        const factors = {
            "躯体化": [0, 3, 11, 26, 39, 41, 47, 51, 52, 55, 57],
            "强迫症状": [2, 8, 9, 27, 37, 44, 45, 50, 54, 64],
            "人际关系敏感": [5, 20, 33, 35, 36, 40, 60, 68, 72],
            "抑郁": [4, 13, 14, 19, 21, 25, 28, 29, 30, 53, 70, 78],
            "焦虑": [1, 16, 22, 32, 38, 56, 66, 77, 79, 85],
            "敌对": [10, 23, 62, 66, 73, 80],
            "恐怖": [12, 24, 46, 49, 69, 74, 81],
            "偏执": [7, 17, 42, 67, 75, 82],
            "精神病性": [6, 15, 34, 61, 63, 71, 76, 83, 84, 89],
            "其他（睡眠饮食）": [18, 43, 58, 59, 64, 65]
        };

        // 因子解释说明库
        const factorExplanations = {
            "躯体化": "主要反映主观的身体不适感，包括心血管、胃肠道、呼吸系统的不适，以及头痛、背痛、肌肉酸痛等躯体症状。",
            "强迫症状": "指那些明知没有必要，但又无法摆脱的无意义思想、冲动和行为，如反复检查、洗涤、计数等。",
            "人际关系敏感": "指人际交往中的不自在感和自卑感，尤其是在与他人比较时更加突出，表现为社交焦虑和自卑。",
            "抑郁": "反映与临床抑郁症状相关的广泛症状，包括心境低落、兴趣减退、缺乏动力、失望、悲观等情感体验。",
            "焦虑": "包括烦躁、坐立不安、神经过敏、紧张以及躯体的震颤、心悸、头晕等焦虑症状。",
            "敌对": "主要从思想、情感和行为三个方面反映敌对的表现，包括厌烦、争论、摔物、冲动等。",
            "恐怖": "反映对社交场合和特定物体的恐惧，如出门旅行、空旷场地、人群或公共交通工具等。",
            "偏执": "指猜疑和关系妄想等偏执性思维，包括敌对、猜疑、夸大、被害等观念。",
            "精神病性": "反映各种精神病性症状的轻度表现，如幻听、思维播散、被控制感等。",
            "其他（睡眠饮食）": "主要反映睡眠和饮食方面的问题，如失眠、早醒、多梦、食欲不振等。"
        };

        const options = ["没有", "很轻", "中等", "偏重", "严重"];
        let currentQuestion = 0;
        let answers = new Array(questions.length).fill(null);
        let factorLevels = {}; // 存储每个因子的程度

        // 初始化页面
        function init() {
            try {
                showQuestion(currentQuestion);
                updateProgress();
                
                document.getElementById('prev-btn').addEventListener('click', prevQuestion);
                document.getElementById('next-btn').addEventListener('click', nextQuestion);
                document.getElementById('submit-btn').addEventListener('click', showResults);
                
                // 检查html2canvas是否加载成功
                if (typeof html2canvas === 'undefined') {
                    console.warn('html2canvas未正确加载，图片保存功能可能不可用');
                }
            } catch (error) {
                console.error('初始化失败:', error);
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('question-container').style.display = 'none';
            }
        }

        // 显示题目
        function showQuestion(index) {
            document.getElementById('question-number').textContent = `题目 ${index + 1}`;
            document.getElementById('question-text').textContent = questions[index];
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            options.forEach((option, i) => {
                const optionElement = document.createElement('div');
                optionElement.className = `option ${answers[index] === i ? 'selected' : ''}`;
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => selectOption(i));
                optionsContainer.appendChild(optionElement);
            });
            
            // 更新按钮状态
            document.getElementById('prev-btn').style.display = index === 0 ? 'none' : 'block';
            document.getElementById('next-btn').style.display = index === questions.length - 1 ? 'none' : 'block';
            document.getElementById('submit-btn').style.display = index === questions.length - 1 ? 'block' : 'none';
            
            // 更新下一题按钮状态
            updateNextButton();
        }

        // 选择选项
        function selectOption(optionIndex) {
            answers[currentQuestion] = optionIndex;
            showQuestion(currentQuestion);
            
            // 自动跳转到下一题（如果不是最后一题）
            if (currentQuestion < questions.length - 1) {
                setTimeout(() => {
                    currentQuestion++;
                    showQuestion(currentQuestion);
                    updateProgress();
                }, 300);
            } else {
                updateNextButton();
            }
        }

        // 更新下一题按钮状态
        function updateNextButton() {
            const nextButton = document.getElementById('next-btn');
            if (answers[currentQuestion] === null) {
                nextButton.disabled = true;
            } else {
                nextButton.disabled = false;
            }
        }

        // 上一题
        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
                updateProgress();
            }
        }

        // 下一题
        function nextQuestion() {
            if (currentQuestion < questions.length - 1 && answers[currentQuestion] !== null) {
                currentQuestion++;
                showQuestion(currentQuestion);
                updateProgress();
            }
        }

        // 更新进度
        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `进度: ${currentQuestion + 1}/${questions.length}`;
        }

        // 设置保存功能
        function setupSaveFunction() {
            const saveButton = document.getElementById('save-image-btn');
            const newTestButton = document.getElementById('new-test-btn');
            
            // 保存图片功能
            saveButton.addEventListener('click', function() {
                if (typeof html2canvas === 'undefined') {
                    alert('图片生成功能暂时不可用，请稍后重试');
                    return;
                }
                
                saveButton.disabled = true;
                saveButton.textContent = '正在生成图片...';
                
                // 临时隐藏保存按钮，避免出现在截图中
                const saveButtons = document.querySelector('.save-buttons');
                const originalDisplay = saveButtons.style.display;
                saveButtons.style.display = 'none';
                
                // 使用html2canvas生成图片
                html2canvas(document.getElementById('result-container'), {
                    scale: 2, // 提高图片质量
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    // 将canvas转换为图片URL
                    const imageURL = canvas.toDataURL('image/png');
                    
                    // 创建下载链接
                    const downloadLink = document.createElement('a');
                    downloadLink.href = imageURL;
                    downloadLink.download = 'SCL-90测评报告.png';
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);
                    
                    // 恢复按钮状态
                    saveButtons.style.display = originalDisplay;
                    saveButton.disabled = false;
                    saveButton.textContent = '💾 生成报告图片';
                    
                }).catch(error => {
                    console.error('生成图片失败:', error);
                    alert('生成失败，请稍后重试');
                    
                    // 恢复按钮状态
                    saveButtons.style.display = originalDisplay;
                    saveButton.disabled = false;
                    saveButton.textContent = '💾 生成报告图片';
                });
            });
            
            // 重新测试功能
            newTestButton.addEventListener('click', function() {
                if (confirm('确定要重新开始测试吗？当前结果将会丢失。')) {
                    // 重置所有状态
                    currentQuestion = 0;
                    answers = new Array(questions.length).fill(null);
                    factorLevels = {};
                    
                    // 显示测试页面，隐藏结果页面
                    document.getElementById('question-container').style.display = 'block';
                    document.getElementById('result-container').style.display = 'none';
                    document.getElementById('progress-text').style.display = 'block';
                    document.querySelector('.progress-container').style.display = 'block';
                    
                    // 重新初始化第一题
                    showQuestion(currentQuestion);
                    updateProgress();
                }
            });
        }

        // 显示结果
        function showResults() {
            // 检查是否所有题目都已回答
            if (answers.includes(null)) {
                alert('请完成所有题目后再提交');
                return;
            }

            // 计算总分和均分
            const totalScore = answers.reduce((sum, answer) => sum + (answer + 1), 0);
            const averageScore = (totalScore / questions.length).toFixed(2);

            // 显示总分和均分
            document.getElementById('total-score').textContent = totalScore;
            document.getElementById('average-score').textContent = averageScore;

            // 生成因子分析部分 - 紧凑表格
            const factorAnalysisContainer = document.getElementById('factor-analysis');
            factorAnalysisContainer.innerHTML = '';

            const factorTable = document.createElement('table');
            factorTable.className = 'compact-table';
            factorTable.innerHTML = `
                <thead>
                    <tr>
                        <th>因子名称</th>
                        <th>总分</th>
                        <th>平均分</th>
                        <th>测试情况</th>
                    </tr>
                </thead>
                <tbody id="factor-table-body">
                </tbody>
            `;

            const factorTableBody = factorTable.querySelector('#factor-table-body');

            for (const [factorName, questionIndices] of Object.entries(factors)) {
                // 计算因子分数
                let factorTotal = 0;
                questionIndices.forEach(index => {
                    factorTotal += answers[index] + 1;
                });
                const factorAverage = (factorTotal / questionIndices.length).toFixed(2);
                
                // 判断程度
                let levelClass = "", levelText = "";
                if (factorAverage < 1.5) {
                    levelClass = "level-normal"; levelText = "正常";
                } else if (factorAverage < 2.0) {
                    levelClass = "level-mild"; levelText = "轻微";
                } else if (factorAverage < 3.0) {
                    levelClass = "level-moderate"; levelText = "中度";
                } else {
                    levelClass = "level-severe"; levelText = "重度";
                }

                // 存储因子程度
                factorLevels[factorName] = { levelClass, levelText };

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${factorName}</td>
                    <td>${factorTotal}</td>
                    <td>${factorAverage}</td>
                    <td><span class="level-badge ${levelClass}">${levelText}</span></td>
                `;
                factorTableBody.appendChild(row);
            }

            factorAnalysisContainer.appendChild(factorTable);

            // 生成分级标准 - 紧凑表格
            const criteriaContainer = document.getElementById('criteria-container');
            criteriaContainer.innerHTML = '';

            const criteriaTable = document.createElement('table');
            criteriaTable.className = 'compact-table';
            criteriaTable.innerHTML = `
                <thead>
                    <tr>
                        <th>程度</th>
                        <th>平均分范围</th>
                        <th>说明</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="level-badge level-normal">正常</span></td>
                        <td>1.0-1.5</td>
                        <td>无明显症状</td>
                    </tr>
                    <tr>
                        <td><span class="level-badge level-mild">轻微</span></td>
                        <td>1.5-2.0</td>
                        <td>症状轻微或偶尔出现</td>
                    </tr>
                    <tr>
                        <td><span class="level-badge level-moderate">中度</span></td>
                        <td>2.0-3.0</td>
                        <td>症状明显但不影响日常生活</td>
                    </tr>
                    <tr>
                        <td><span class="level-badge level-severe">重度</span></td>
                        <td>3.0-5.0</td>
                        <td>症状严重且明显影响日常生活</td>
                    </tr>
                </tbody>
            `;
            criteriaContainer.appendChild(criteriaTable);

            // 因子解释 - 包含个人测试结果
            const factorExplanationsContainer = document.getElementById('factor-explanations');
            factorExplanationsContainer.innerHTML = '';

            for (const [factorName, explanation] of Object.entries(factorExplanations)) {
                const userLevel = factorLevels[factorName];
                const explanationElement = document.createElement('div');
                explanationElement.className = 'factor-explanation';
                explanationElement.innerHTML = `
                    <div class="explanation-title">${factorName}：<span class="level-badge ${userLevel.levelClass}">${userLevel.levelText}</span></div>
                    <div>${explanation}</div>
                `;
                factorExplanationsContainer.appendChild(explanationElement);
            }

            // 温馨解读
            const warmInterpretation = `
                <h4>致亲爱的你：</h4>
                <p>请用从容的心态来看待本次测试。无论分数如何，请一定记得，我们始终都在你身边。</p>
                
                <p>SCL-90 心理健康自评量表涵盖了情绪状态、思维模式、人际关系、生活习惯等多个维度，它就像一面温柔的镜子，能帮你更清晰地看见自己当下的心理状态。需要知道的是，量表得分仅仅是近期心理感受的投射。</p>
                
                <p>若某些因子得分较高，或许只是说明你最近在这些方面暂时感受到了压力或困扰，但这绝不等于你存在严重的问题。很多时候，短期的心理波动本就是生活的常态——可能是学习的节奏、工作的挑战，或是人际交往中的小插曲带来的暂时影响。</p>
                
                <p>如果你发现自己在多个维度上长期感到不适，不妨多给自己一些关注：试着调整自己的作息规律，找到适合自己的放松方式，或是和信任的人好好倾诉聊聊。倘若情绪已经悄悄影响到了日常生活，且靠自己难以调节，也请不要犹豫，及时寻求专业的心理咨询或帮助，这并不是软弱，而是对自己的负责。要知道，心理健康和身体健康同样重要，而你，本就值得被好好关心与坚定支持。</p>
            `;

            document.getElementById('overall-interpretation').innerHTML = warmInterpretation;

            // 显示报告页面
            document.getElementById('question-container').style.display = 'none';
            document.getElementById('result-container').style.display = 'block';
            document.getElementById('progress-text').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';

            // 设置保存功能
            setTimeout(setupSaveFunction, 100);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
